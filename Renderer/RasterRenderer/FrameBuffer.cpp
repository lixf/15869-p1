#include "FrameBuffer.h"
#include "CoreLib/Imaging/Bitmap.h"

using namespace CoreLib::Imaging;

namespace RasterRenderer
{
    const int FrameBuffer::MultiSampleOffsets[][64] =
    {
        {
            0, 0
        },
        // 2x samples
        {
            4, 4,
            -4, -4
        },

        // 4x samples
        {
            -2, -6,
            6, -2,
            -6, 2,
            2, 6
        }, 
        // 8x samples
        {
            1, -3,
            -1, 3,
            5, 1,
            -3, -5,
            -5, 5,
            -7, -1,
            3, 7,
            7, -7
        },
        // 16x samples
        {
            1, 1,
            -1, -3,
            -3, 2,
            4, -1,
            -5, -2,
            2, 5,
            5, 3,
            3, -5,
            -2, 6,
            0, -7,
            -4, -6,
            -6, 4,
            -8, 0,
            7, -4,
            6, 7,
            -7, -8
        },
        // 32x samples
        {
            1, 1,
            -1, -3,
            -3, 2,
            4, -1,
            -5, -2,
            2, 5,
            5, 3,
            3, -5,
            -2, 6,
            0, -7,
            -4, -6,
            -6, 4,
            -8, 0,
            7, -4,
            6, 7,
            -7, -8,

            1, 3,
            -3, -3,
            -3, 0,
            6, -2,
            -7, -1,
            3, 4,
            7, 3,
            3, -6,
            -2, 7,
            0, -4,
            -2, -5,
            -7, 6,
            -8, 3,
            4, -1,
            2, 7,
            4, -8
        }
    };
    void FrameBuffer::SaveColorBuffer(String fileName)
    {
        ImageRef img(width, height, (float*)GetColorBuffer());
        img.SaveAsBmpFile(fileName, true);
    }
}

/*
SCILAB
DIMENSION = 4
BASE = 2
====================================================================
       0       0.000000       0.000000       0.000000       0.000000
       1       0.500000       0.500000       0.750000       0.875000
       2       0.250000       0.750000       0.562500       0.765625
       3       0.750000       0.250000       0.312500       0.140625
       4       0.125000       0.625000       0.437500       0.546875
       5       0.625000       0.125000       0.687500       0.421875
       6       0.375000       0.375000       0.875000       0.281250
       7       0.875000       0.875000       0.125000       0.656250
       8       0.062500       0.937500       0.953125       0.234375
       9       0.562500       0.437500       0.203125       0.859375
      10       0.312500       0.187500       0.390625       0.968750
      11       0.812500       0.687500       0.640625       0.093750
      12       0.187500       0.312500       0.515625       0.687500
      13       0.687500       0.812500       0.265625       0.312500
      14       0.437500       0.562500       0.078125       0.453125
      15       0.937500       0.062500       0.828125       0.578125
      16       0.031250       0.531250       0.734375       0.345703
      17       0.531250       0.031250       0.484375       0.720703
      18       0.281250       0.281250       0.171875       0.611328
      19       0.781250       0.781250       0.921875       0.486328
      20       0.156250       0.156250       0.796875       0.830078
      21       0.656250       0.656250       0.046875       0.205078
      22       0.406250       0.906250       0.359375       0.064453
      23       0.906250       0.406250       0.609375       0.939453
      24       0.093750       0.468750       0.281250       0.392578
      25       0.593750       0.968750       0.531250       0.517578
      26       0.343750       0.718750       0.843750       0.626953
      27       0.843750       0.218750       0.093750       0.251953
      28       0.218750       0.843750       0.218750       0.908203
      29       0.718750       0.343750       0.968750       0.033203
      30       0.468750       0.093750       0.656250       0.173828
      31       0.968750       0.593750       0.406250       0.798828
      32       0.015625       0.796875       0.425781       0.708984
      33       0.515625       0.296875       0.675781       0.333984
      34       0.265625       0.046875       0.988281       0.443359
      35       0.765625       0.546875       0.238281       0.568359
      36       0.140625       0.421875       0.113281       0.224609
      37       0.640625       0.921875       0.863281       0.849609
      38       0.390625       0.671875       0.550781       0.990234
      39       0.890625       0.171875       0.300781       0.115234
      40       0.078125       0.234375       0.597656       0.537109
      41       0.578125       0.734375       0.347656       0.412109
      42       0.328125       0.984375       0.035156       0.302734
      43       0.828125       0.484375       0.785156       0.677734
      44       0.203125       0.609375       0.910156       0.021484
      45       0.703125       0.109375       0.160156       0.896484
      46       0.453125       0.359375       0.472656       0.755859
      47       0.953125       0.859375       0.722656       0.130859
      48       0.046875       0.265625       0.816406       0.925781
      49       0.546875       0.765625       0.066406       0.050781
      50       0.296875       0.515625       0.253906       0.160156
      51       0.796875       0.015625       0.503906       0.785156
      52       0.171875       0.890625       0.628906       0.378906
      53       0.671875       0.390625       0.378906       0.503906
      54       0.421875       0.140625       0.191406       0.644531
      55       0.921875       0.640625       0.941406       0.269531
      56       0.109375       0.703125       0.144531       0.816406
      57       0.609375       0.203125       0.894531       0.191406
      58       0.359375       0.453125       0.707031       0.082031
      59       0.859375       0.953125       0.457031       0.957031
      60       0.234375       0.078125       0.332031       0.363281
      61       0.734375       0.578125       0.582031       0.738281
      62       0.484375       0.828125       0.769531       0.597656
      63       0.984375       0.328125       0.019531       0.472656
      64       0.007813       0.664063       0.792969       0.435547
      65       0.507813       0.164063       0.042969       0.560547
      66       0.257813       0.414063       0.355469       0.669922
      67       0.757813       0.914063       0.605469       0.294922
      68       0.132813       0.039063       0.730469       0.888672
      69       0.632813       0.539063       0.480469       0.013672
      70       0.382813       0.789063       0.167969       0.154297
      71       0.882813       0.289063       0.917969       0.779297
      72       0.070313       0.351563       0.246094       0.326172
      73       0.570313       0.851563       0.996094       0.701172
      74       0.320313       0.601563       0.683594       0.591797
      75       0.820313       0.101563       0.433594       0.466797
      76       0.195313       0.976563       0.308594       0.873047
      77       0.695313       0.476563       0.558594       0.248047
      78       0.445313       0.226563       0.871094       0.107422
      79       0.945313       0.726563       0.121094       0.982422
      80       0.039063       0.132813       0.464844       0.214844
      81       0.539063       0.632813       0.714844       0.839844
      82       0.289063       0.882813       0.902344       0.949219
      83       0.789063       0.382813       0.152344       0.074219
      84       0.164063       0.507813       0.027344       0.730469
      85       0.664063       0.007813       0.777344       0.355469
      86       0.414063       0.257813       0.589844       0.496094
      87       0.914063       0.757813       0.339844       0.621094
      88       0.101563       0.820313       0.511719       0.042969
      89       0.601563       0.320313       0.261719       0.917969
      90       0.351563       0.070313       0.074219       0.808594
      91       0.851563       0.570313       0.824219       0.183594
      92       0.226563       0.445313       0.949219       0.527344
      93       0.726563       0.945313       0.199219       0.402344
      94       0.476563       0.695313       0.386719       0.261719
      95       0.976563       0.195313       0.636719       0.636719
      96       0.023438       0.398438       0.648438       0.851563
      97       0.523438       0.898438       0.398438       0.226563
      98       0.273438       0.648438       0.210938       0.117188
      99       0.773438       0.148438       0.960938       0.992188
     100       0.148438       0.773438       0.835938       0.335938


     */
